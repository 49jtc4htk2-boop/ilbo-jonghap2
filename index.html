<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title> ğŸŒ³ì¼ì¼ ì „ë„ í™œë™ ìë™ ì¢…í•©ğŸŒ³ </title>
<style>
    body{
        font-family: "Pretendard", Arial, sans-serif;
        background:#f7f7f7;
        padding:20px;
        line-height:1.6;
    }

    textarea{
        width:100%;
        height:260px;
        padding:12px;
        font-size:14px;
        border-radius:8px;
        border:1px solid #ccc;
    }

    button{
        padding:10px 20px;
        border:none;
        background:#4CAF50;
        color:white;
        border-radius:6px;
        cursor:pointer;
        margin-right:6px;
        font-size:14px;
    }

    button:hover{
        background:#449d48;
    }

    #result-box{
        margin-top:20px;
        white-space:pre-wrap;
        background:white;
        padding:20px;
        border-radius:10px;
        border:1px solid #ddd;
        font-size:15px;
    }

    #error-info{
      background:#fff8d1;
      border:2px solid #f1c40f;
      padding:14px;
      border-radius:10px;
      color:#8a6d00;
      font-weight:600;
      font-size:14px;
      margin-top:20px;
      box-shadow:0 3px 6px rgba(0,0,0,0.08);
      animation: pulse 1.4s infinite;
    }

    @keyframes pulse{
      0%{box-shadow:0 0 0 rgba(241,196,15,0.5);}
      50%{box-shadow:0 0 12px rgba(241,196,15,0.9);}
      100%{box-shadow:0 0 0 rgba(241,196,15,0.5);}
    }
</style>
</head>
<body>

<h2>ğŸŒ³ ì¼ì¼ ì „ë„ í™œë™ ìë™ ì¢…í•© ğŸŒ³</h2>

<textarea id="inputText" placeholder="ì—¬ê¸°ì— ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”."></textarea>

<br /><br />

<button onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
<button onclick="copyResult()">ë³µì‚¬í•˜ê¸°</button>

<div id="result-box"></div>

<div id="error-info">
    <strong>â€» ì˜¤ë¥˜ ì•ˆë‚´</strong><br>
    - êµ¬ì—­ë³„ ì¹¸ì´ 10ê°œê°€ ì•„ë‹Œ ê²½ìš°<br>
    - ê´„í˜¸ ì• ìˆ«ìì™€ ê´„í˜¸ ì•ˆ ìˆ«ì í•©ì´ ë‹¤ë¥¸ ê²½ìš°<br>
    - ë™ì¼ ì¸ë¬¼ì´ ì„œë¡œ ë‹¤ë¥¸ êµ¬ì—­/ì¹¸ì— ë“±ì¥í•˜ëŠ” ê²½ìš°<br>
    - ì´ë¦„ì´ ëˆ„ë½ëœ ê²½ìš°(íƒ€êµ¬ì—­ê³¼ ì†Œí†µ í•„ìš”)<br>
</div>

<script>
function extractItems(text){
    // ê´„í˜¸ ì•ˆì˜ ë°ì´í„° ë¶„ë¦¬
    const match = text.match(/\((.*?)\)/);
    if(!match) return [];
    const inner = match[1].trim();

    return inner.split(/\s+/).map(item => {
        const m = item.match(/^(.*?)(?:([0-9.]+))?$/);
        if(!m) return null;
        let name = m[1].replace(/[.]/g,"").trim();
        let val = 1;

        if(item.includes(".5")) val = 0.5;
        if(item.includes("1")) val = 1;
        if(item.includes("2")) val = 2;

        return {name, value: val};
    }).filter(Boolean);
}

function calculate(){
    const raw = document.getElementById("inputText").value.trim();
    const lines = raw.split("\n").map(l => l.trim()).filter(l => l);

    let zoneLines = lines.filter(l => /^[0-9]+\//.test(l));
    let errors = [];
    let globalNames = {}; // ëª¨ë“  ì´ë¦„ ì¶œí˜„ ì¶”ì 
    let sum = {
        ë³´ìœ :0, ì°¾ê¸°:0, ì„­ì™¸:0, ë§Œë‚¨:0,
        ë‹¨ê³„:0, ìƒë‹´:0,
        ë§ì”€:{}, ì„¼í„°:{}
    };

    for(let line of zoneLines){
        const parts = line.split("/");

        if(parts.length !== 10){
            errors.push(`${parts[0]}êµ¬ì—­ ì¹¸ ê°œìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.`);
            continue;
        }

        const [zone, leader, ë³´ìœ , ì°¾ê¸°, ì„­ì™¸, ë§Œë‚¨, ë‹¨ê³„, ìƒë‹´, ë§ì”€, ì„¼í„°] = parts;

        function checkBracket(field, label){
            const match = field.match(/^([0-9.]+)\(/);
            if(!match) return;

            const expected = parseFloat(match[1]);
            const list = extractItems(field);
            let total = list.reduce((a,b) => a + b.value, 0);

            if(expected !== total){
                errors.push(`${zone}êµ¬ì—­ ${label} ê´„í˜¸ ì•ˆì˜ ìˆ˜ì¹˜ì˜ í•©ê³¼ ê´„í˜¸ ì• ìˆ«ìê°€ í‹€ë¦½ë‹ˆë‹¤.`);
            }
            return list;
        }

        const ì°¾ê¸°List = checkBracket(ì°¾ê¸°,"ë‹¹ì¼ ì°¾ê¸°");
        const ì„­ì™¸List = checkBracket(ì„­ì™¸,"ë‹¹ì¼ ì„­ì™¸");
        const ë³´ìœ List = extractItems(ë³´ìœ );
        const ë§Œë‚¨List = extractItems(ë§Œë‚¨);
        const ë‹¨ê³„List = extractItems(ë‹¨ê³„);
        const ìƒë‹´List = extractItems(ìƒë‹´);
        const ë§ì”€List = extractItems(ë§ì”€);
        const ì„¼í„°List = extractItems(ì„¼í„°);

        function addPeople(list,label){
            if(!list) return;
            for(let p of list){
                if(label === "ë§ì”€"){
                    if(!sum.ë§ì”€[p.name]) sum.ë§ì”€[p.name] = 0;
                    sum.ë§ì”€[p.name] += p.value;
                }else if(label === "ì„¼í„°"){
                    if(!sum.ì„¼í„°[p.name]) sum.ì„¼í„°[p.name] = 0;
                    sum.ì„¼í„°[p.name] += p.value;
                }else{
                    sum[label] += p.value;
                }

                if(label !== "ë³´ìœ "){ 
                    if(!globalNames[p.name]) globalNames[p.name] = [];
                    globalNames[p.name].push({zone, label});
                }
            }
        }

        addPeople(ë³´ìœ List,"ë³´ìœ ");
        addPeople(ì°¾ê¸°List,"ì°¾ê¸°");
        addPeople(ì„­ì™¸List,"ì„­ì™¸");
        addPeople(ë§Œë‚¨List,"ë§Œë‚¨");
        addPeople(ë‹¨ê³„List,"ë‹¨ê³„");
        addPeople(ìƒë‹´List,"ìƒë‹´");
        addPeople(ë§ì”€List,"ë§ì”€");
        addPeople(ì„¼í„°List,"ì„¼í„°");
    }

    /* ì¤‘ë³µÂ·ì¶©ëŒ ì´ë¦„ ê²€ì¦ */
    for(let name in globalNames){
        let arr = globalNames[name];
        let zones = [...new Set(arr.map(a=>a.zone))];

        if(arr.length === 1 && arr[0].value === 0.5){
            errors.push(`${arr[0].zone}êµ¬ì—­ì˜ â€œ${name}.5â€ëŠ” ì–´ë–¤ êµ¬ì—­ê³¼ í•¨ê»˜ í•˜ì…¨ë‚˜ìš”?`);
        }

        if(zones.length > 1){
            errors.push(`${arr[0].zone}êµ¬ì—­ ${arr[0].label} vs ${arr[1].zone}êµ¬ì—­ ${arr[1].label}`);
        }
    }

    let output = "";
    if(errors.length){
        output += "âš  ì˜¤ë¥˜ ë°œìƒ âš \n\n";
        output += errors.join("\n");
    } else {
        output += "ì¢…í•©/";
        output += `${sum.ë³´ìœ }/`;
        output += `${sum.ì°¾ê¸°}/`;
        output += `${sum.ì„­ì™¸}/`;
        output += `${sum.ë§Œë‚¨}/`;
        output += `${sum.ë‹¨ê³„}/`;
        output += `${sum.ìƒë‹´}/`;

        output += Object.keys(sum.ë§ì”€).length ? 
            Object.entries(sum.ë§ì”€).map(([n,v])=>`${n}${v}`).join(" ") : "0";
        output += "/";

        output += Object.keys(sum.ì„¼í„°).length ? 
            Object.entries(sum.ì„¼í„°).map(([n,v])=>`${n}${v}`).join(" ") : "0";
    }

    document.getElementById("result-box").textContent = output;
}

function copyResult(){
    const text = document.getElementById("result-box").textContent;
    navigator.clipboard.writeText(text);
    alert("âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
}
</script>

</body>
</html>
