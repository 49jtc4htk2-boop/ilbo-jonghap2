<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì „ë„ ì¼ë³´ ìë™ ì¢…í•©ê¸°</title>
<style>
    body { font-family: sans-serif; margin: 40px; }
    textarea { width: 100%; height: 250px; font-size: 15px; }
    pre { background: #f6f6f6; padding: 20px; white-space: pre-wrap; }
    button { margin-right: 10px; padding: 8px 16px; font-size: 15px; cursor: pointer; }
</style>
</head>
<body>

<h2>ğŸ“Œ ì „ë„ ì¼ë³´ ìë™ ì¢…í•©ê¸°</h2>
<p>ì•„ë˜ì— ì¼ë³´ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>

<textarea id="inputText"></textarea><br><br>

<button onclick="calculate()">ì¢…í•© ê³„ì‚°í•˜ê¸°</button>
<button onclick="copyOutput()">ğŸ“‹ ì¢…í•© ë³µì‚¬í•˜ê¸°</button>

<h3>ğŸ“Š ì¢…í•© ê²°ê³¼</h3>
<pre id="output"></pre>

<script>
function calculate() {
    const text = document.getElementById("inputText").value;

    const totals = {
        ì„­ì™¸ìë³´ìœ : 0,
        ë‹¹ì¼ì°¾ê¸°: 0,
        ë‹¹ì¼ì„­ì™¸: 0,
        ë§Œë‚¨: 0,
        ë‹¨ê³„í–¥ìƒ: 0,
        ìƒë‹´: 0,
        ë§ì”€: 0,
        ì„¼í„°: 0
    };

    const nameTotals = { ë§ì”€: {}, ì„¼í„°: {} };

    const lines = text.split("\n").filter(l => l.match(/^\d+\//));

    function sumNumbers(str) {
        if (!str) return 0;
        return str.match(/[\d\.]+/g)?.map(Number).reduce((a, b) => a + b, 0) || 0;
    }

    function extractNames(str, store) {
        if (!str) return;
        const items = str.match(/[ê°€-í£A-Za-z0-9]+\.?\d*/g) || [];

        items.forEach(item => {
            const match = item.match(/^([ê°€-í£A-Za-z0-9]+)(\.(\d+))?$/);
            if (!match) return;

            const name = match[1];
            const value = match[3] ? Number("0." + match[3]) : 1;
            store[name] = (store[name] || 0) + value;
        });
    }

    lines.forEach(line => {
        const p = line.split("/");

        totals.ì„­ì™¸ìë³´ìœ  += sumNumbers(p[2]);
        totals.ë‹¹ì¼ì°¾ê¸°   += sumNumbers(p[3]);
        totals.ë‹¹ì¼ì„­ì™¸   += sumNumbers(p[4]);
        totals.ë§Œë‚¨       += sumNumbers(p[5]);
        totals.ë‹¨ê³„í–¥ìƒ   += sumNumbers(p[6]);
        totals.ìƒë‹´       += sumNumbers(p[7]);

        totals.ë§ì”€ += sumNumbers(p[8]);
        extractNames(p[8], nameTotals.ë§ì”€);

        totals.ì„¼í„° += sumNumbers(p[9]);
        extractNames(p[9], nameTotals.ì„¼í„°);
    });

    function nameSummary(obj) {
        const entries = Object.entries(obj);
        if (entries.length === 0) return "";
        return entries.map(([name, val]) => `${name}${val}`).join(" ");
    }

    const result =
        "ì¢…í•©/" +
        totals.ì„­ì™¸ìë³´ìœ  + "/" +
        totals.ë‹¹ì¼ì°¾ê¸° + "/" +
        totals.ë‹¹ì¼ì„­ì™¸ + "/" +
        totals.ë§Œë‚¨ + "/" +
        totals.ë‹¨ê³„í–¥ìƒ + "/" +
        totals.ìƒë‹´ + "/" +
        totals.ë§ì”€ + (nameSummary(nameTotals.ë§ì”€) ? `(${nameSummary(nameTotals.ë§ì”€)})` : "") + "/" +
        totals.ì„¼í„° + (nameSummary(nameTotals.ì„¼í„°) ? `(${nameSummary(nameTotals.ì„¼í„°)})` : "");

    document.getElementById("output").innerText = result;
}

function copyOutput() {
    const text = document.getElementById("output").innerText;

    if (!text.trim()) {
        alert("ë³µì‚¬í•  ì¢…í•© ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê³„ì‚°í•´ì£¼ì„¸ìš”!");
        return;
    }

    navigator.clipboard.writeText(text).then(() => {
        alert("âœ… ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
    });
}
</script>

</body>
</html>
