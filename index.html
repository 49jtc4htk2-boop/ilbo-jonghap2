<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¼ì¼ ì „ë„ í™œë™ ë³´ê³  ì¢…í•©</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
textarea { width: 100%; height: 250px; font-family: monospace; margin-bottom: 10px; }
button { padding: 10px 20px; margin-bottom: 10px; }
pre { background: #f0f0f0; padding: 10px; white-space: pre-wrap; }
.error { color: red; font-weight: bold; }
table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
td, th { border: 1px solid #ccc; padding: 5px; text-align: center; }
th { background: #eee; }
</style>
</head>
<body>

<h2>ğŸŒ³ ì¼ì¼ ì „ë„ í™œë™ ë³´ê³  ì¢…í•© (ì¹¸ë³„) ğŸŒ³</h2>

<textarea id="inputData" placeholder="ì—¬ê¸°ì— ë³´ê³  ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
<br>
<button onclick="calculate()">ê³„ì‚°</button>
<button onclick="copyToClipboard()">ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>

<h3>ê²°ê³¼</h3>
<pre id="output"></pre>

<script>
let latestResult = '';

function calculate() {
    const input = document.getElementById('inputData').value.trim();
    const output = document.getElementById('output');
    output.textContent = '';
    latestResult = '';

    if(!input) {
        output.textContent = 'ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        return;
    }

    const lines = input.split('\n').filter(l => l.trim() !== '');
    const dataLines = lines.slice(2, lines.findIndex(l => l.startsWith('ì¢…í•©')));
    const êµ¬ì—­ë³„í•© = [];
    const ì¢…í•© = {ì„­ì™¸ìë³´ìœ :0, ë‹¹ì¼ì°¾ê¸°:0, ë‹¹ì¼ì„­ì™¸:0, ë‹¹ì¼ë§Œë‚¨:0, ë‹¨ê³„í–¥ìƒ:0, ìƒë‹´:0, ë§ì”€:0, ì„¼í„°:0};
    const ì´ë¦„ì¹¸ = {}; // ì¤‘ë³µ ì²´í¬
    const ì´ë¦„íšŸìˆ˜ = {}; // .5 ì²´í¬

    const ì¹¸ì´ë¦„ = ['ì„­ì™¸ìë³´ìœ ','ë‹¹ì¼ì°¾ê¸°','ë‹¹ì¼ì„­ì™¸','ë‹¹ì¼ë§Œë‚¨','ë‹¨ê³„í–¥ìƒ','ìƒë‹´','ë§ì”€','ì„¼í„°'];

    for(const line of dataLines){
        const parts = line.split('/');
        const êµ¬ì—­ = parts[0];
        const êµ¬ì—­ì¥ = parts[1];
        const ì¹¸ë°ì´í„° = parts.slice(2);

        if(ì¹¸ë°ì´í„°.length < 8) {
            êµ¬ì—­ë³„í•©.push({êµ¬ì—­, error:`${êµ¬ì—­}êµ¬ì—­ ì¹¸ ê°œìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.`});
            continue;
        }

        const êµ¬ì—­í•© = {};
        ì¹¸ë°ì´í„°.forEach((ì¹¸, idx)=>{
            let sum = 0;
            if(idx === 0){ // ì„­ì™¸ìë³´ìœ 
                sum = parseFloat(ì¹¸.split('(')[0]) || 0;
                ì¢…í•©['ì„­ì™¸ìë³´ìœ '] += sum;
                êµ¬ì—­í•©[ì¹¸ì´ë¦„[idx]] = sum;
            } else {
                // ìˆ«ì ì¶”ì¶œ
                const regex = /([0-9]+(?:\.5)?)/g;
                const matches = ì¹¸.match(regex);
                if(matches){
                    sum = matches.reduce((a,b)=>a+parseFloat(b),0);
                    ì¢…í•©[ì¹¸ì´ë¦„[idx]] += sum;
                }
                êµ¬ì—­í•©[ì¹¸ì´ë¦„[idx]] = sum;

                // ì´ë¦„ ì¶”ì¶œ(.5 í¬í•¨)
                const nameRegex = /([ê°€-í£]+)(?:\.5)?/g;
                let m;
                while((m = nameRegex.exec(ì¹¸)) !== null){
                    const name = m[1];
                    if(!ì´ë¦„ì¹¸[name]) ì´ë¦„ì¹¸[name] = [];
                    ì´ë¦„ì¹¸[name].push({êµ¬ì—­: êµ¬ì—­, ì¹¸: ì¹¸ì´ë¦„[idx]});

                    if(!ì´ë¦„íšŸìˆ˜[name]) ì´ë¦„íšŸìˆ˜[name] = 0;
                    if(m[0].includes('.5')) ì´ë¦„íšŸìˆ˜[name]++;
                }
            }
        });
        êµ¬ì—­ë³„í•©.push({êµ¬ì—­, êµ¬ì—­ì¥, ...êµ¬ì—­í•©});
    }

    // ì¤‘ë³µ ì²´í¬
    const ì¤‘ë³µì˜¤ë¥˜ = [];
    for(const [name, occurrences] of Object.entries(ì´ë¦„ì¹¸)){
        for(let i=0;i<occurrences.length;i++){
            for(let j=i+1;j<occurrences.length;j++){
                const a = occurrences[i];
                const b = occurrences[j];
                if(a.êµ¬ì—­ === b.êµ¬ì—­){
                    if((a.ì¹¸==='ë‹¹ì¼ì°¾ê¸°' && b.ì¹¸==='ë‹¹ì¼ì„­ì™¸') || (a.ì¹¸==='ë‹¹ì¼ì„­ì™¸' && b.ì¹¸==='ë‹¹ì¼ì°¾ê¸°')) continue;
                    ì¤‘ë³µì˜¤ë¥˜.push(`${name}, ${a.êµ¬ì—­}(${a.ì¹¸}) vs ${b.êµ¬ì—­}(${b.ì¹¸})`);
                } else {
                    if( (a.ì¹¸==='ë‹¹ì¼ì°¾ê¸°' && b.ì¹¸==='ë‹¹ì¼ì„­ì™¸') || (a.ì¹¸==='ë‹¹ì¼ì„­ì™¸' && b.ì¹¸==='ë‹¹ì¼ì°¾ê¸°') ) continue;
                    if(a.ì¹¸ === b.ì¹¸) ì¤‘ë³µì˜¤ë¥˜.push(`${name}, ${a.êµ¬ì—­}(${a.ì¹¸}) vs ${b.êµ¬ì—­}(${b.ì¹¸})`);
                }
            }
        }
    }

    // .5 ê·œì¹™ ì²´í¬
    const ì ì˜¤ë¥˜ = [];
    for(const [name, cnt] of Object.entries(ì´ë¦„íšŸìˆ˜)){
        if(cnt === 1) ì ì˜¤ë¥˜.push(`${name}ê°€ .5ë¡œ ë”± 1ë²ˆ ë“±ì¥`);
    }

    // ê²°ê³¼ ì¶œë ¥
    let resultText = '';
    resultText += 'â–  êµ¬ì—­ë³„Â·ì¹¸ë³„ í•©ê³„\n';
    resultText += 'êµ¬ì—­ | ì„­ì™¸ìë³´ìœ  | ë‹¹ì¼ì°¾ê¸° | ë‹¹ì¼ì„­ì™¸ | ë‹¹ì¼ë§Œë‚¨ | ë‹¨ê³„í–¥ìƒ | ìƒë‹´ | ë§ì”€ | ì„¼í„°\n';
    resultText += '----|----|----|----|----|----|----|----|----\n';
    êµ¬ì—­ë³„í•©.forEach(g=>{
        if(g.error){
            resultText += `${g.error}\n`;
        } else {
            resultText += `${g.êµ¬ì—­} | ${g.ì„­ì™¸ìë³´ìœ } | ${g.ë‹¹ì¼ì°¾ê¸°} | ${g.ë‹¹ì¼ì„­ì™¸} | ${g.ë‹¹ì¼ë§Œë‚¨} | ${g.ë‹¨ê³„í–¥ìƒ} | ${g.ìƒë‹´} | ${g.ë§ì”€} | ${g.ì„¼í„°}\n`;
        }
    });

    resultText += '\nâ–  ì¹¸ë³„ ì´í•©\n';
    for(const [k,v] of Object.entries(ì¢…í•©)){
        resultText += `${k}: ${v}\n`;
    }

    if(ì¤‘ë³µì˜¤ë¥˜.length>0){
        resultText += '\nâš ï¸ ì¤‘ë³µ ì˜¤ë¥˜:\n' + ì¤‘ë³µì˜¤ë¥˜.join('\n') + '\n';
    } else {
        resultText += '\nì¤‘ë³µ ì˜¤ë¥˜ ì—†ìŒ âœ…\n';
    }

    if(ì ì˜¤ë¥˜.length>0){
        resultText += '\nâš ï¸ .5 ê·œì¹™ ì˜¤ë¥˜:\n' + ì ì˜¤ë¥˜.join('\n') + '\n';
    }

    output.textContent = resultText;
    latestResult = resultText;
}

function copyToClipboard() {
    if(!latestResult) {
        alert('ë¨¼ì € ê³„ì‚° ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
        return;
    }
    navigator.clipboard.writeText(latestResult).then(()=>{
        alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }).catch(err=>{
        alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err);
    });
}
</script>

</body>
</html>
