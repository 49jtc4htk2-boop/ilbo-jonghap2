<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>일일 전도 활동 종합 계산기</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 10px; }
h2 { text-align: center; margin-bottom: 10px; }
textarea { width: 100%; height: 250px; font-size: 16px; padding: 10px; margin-bottom: 10px; resize: vertical; }
button { width: 100%; font-size: 16px; padding: 10px; margin: 5px 0; cursor: pointer; border: none; border-radius: 5px; background: #4CAF50; color: white; }
button:hover { background: #45a049; }
#result { margin-top: 10px; font-weight: bold; font-size: 18px; background: #fff; padding: 10px; border-radius: 5px; word-break: break-word; }
</style>
</head>
<body>

<h2>일일 전도 활동 종합 계산기</h2>

<textarea id="inputText" placeholder="일보 텍스트를 여기에 붙여넣기"></textarea>
<button id="calculateBtn">종합하기</button>
<div id="result"></div>
<button id="copyBtn">결과 복사</button>

<script>
function getColName(i){
  return ["섭외자보유","당일 찾기","당일 섭외","당일 만남",
          "단계향상 만남","상담따기","말씀따기","센터확답"][i-2];
}

const ALLOWED = ["당일 찾기","당일 섭외","당일 만남"];

document.getElementById("calculateBtn").onclick = () => {
  const text = document.getElementById("inputText").value;
  const lines = text.split(/\r?\n/);

  const sums = Array(8).fill(0);
  const nameToCols = {};
  const halfCount = {};
  const errors = [];

  lines.forEach(line => {
    if(!/^\d+\//.test(line)) return;
    const parts = line.split("/");

    for(let i=2;i<=9;i++){
      const cell = parts[i];
      if(!cell) continue;

      const num = parseFloat(cell);
      if(!isNaN(num)) sums[i-2] += num;

      const m = cell.match(/\(([^)]+)\)/);
      if(!m) continue;

      m[1].split(" ").forEach(n => {
        const name = n.replace(/[0-9.]/g,"");
        const col = getColName(i);

        if(!nameToCols[name]) nameToCols[name] = new Set();
        nameToCols[name].add(col);

        if(n.includes(".5")){
          halfCount[name] = (halfCount[name]||0)+1;
        }
      });
    }
  });

  /* ✅ 다른 칸 중복 오류 */
  for(const name in nameToCols){
    const cols = [...nameToCols[name]];
    const illegal = cols.filter(c => !ALLOWED.includes(c));
    if(illegal.length >= 2){
      errors.push(`"${name}": ${illegal.join(" vs ")}`);
    }
  }

  /* ✅ .5 단독 오류 */
  for(const name in halfCount){
    if(halfCount[name] === 1){
      errors.push(`"${name}.5"는 어떤 구역과 함께 하셨나요?`);
    }
  }

  /* ❌ 오류 있으면 종합 중단 */
  if(errors.length){
    document.getElementById("result").innerText =
      "오류: " + errors.join("; ");
    return;
  }

  /* ✅ 종합 (정수만) */
  const result = sums.map(n => Math.round(n)).join("/");
  document.getElementById("result").innerText = "종합/" + result;
};

document.getElementById("copyBtn").onclick = () => {
  navigator.clipboard.writeText(
    document.getElementById("result").innerText
  );
  alert("결과가 복사되었습니다!");
};
</script>

</body>
</html>
